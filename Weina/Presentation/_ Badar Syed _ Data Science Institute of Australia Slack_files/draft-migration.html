<!DOCTYPE html>
<!-- saved from url=(0037)https://app.slack.com/draft-migration -->
<html lang="en-US" class=""><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="referrer" content="no-referrer"><meta name="superfish" content="nofish"><script type="text/javascript">(function() {
  var MESSAGE_TYPE = "draft-migration";
  var WRITE_TO_STORAGE_DELAY_MS = 1000;
  var SLACK_DOMAIN_BLOCKLIST = [
    'abetterwaytopay',
    'admin',
    'alpha',
    'api',
    'app',
    'app-beta',
    'app-debug',
    'assets',
    'astronaut',
    'auth',
    'beta',
    'blog',
    'brewbetter',
    'campaign',
    'coffeefanatics',
    'decodingdna',
    'dev',
    'deployplane',
    'ec2',
    'edgeapi',
    'email',
    'email2',
    'email3',
    'email4',
    'enterprise',
    'example',
    'external-callbacks',
    'external-callbacks-elb',
    'files',
    'files-edge',
    'files-origin',
    'genehunters',
    'givewater',
    'go',
    'go-beta',
    'go-debug',
    'h20forall',
    'h2oforall',
    'help',
    'hooks',
    'hub',
    'huntingghostparticles',
    'internal-api',
    'internal-callbacks',
    'internal-callbacks-eu',
    'jdev',
    'join',
    'join-beta',
    'join-debug',
    'jstaging',
    'marsandbeyond',
    'my',
    'neutrinoinahaystack',
    'oauth2',
    'openforbusiness',
    'platform-tls-client',
    'popsicletown',
    'pouroverthetop',
    'qa',
    'realtimediagnosis',
    'roiproofpoints',
    'rovingthegalaxy',
    'slack-email',
    'slack-infra',
    'staging',
    'status',
    'supersciencehub',
    'takecredit',
    'test',
    'tools',
    'try',
    'upload',
    'upload-edge',
    'global-upload-edge',
    'universal-upload-edge',
    'cfr-upload-edge',
    'v2',
    'waterislife',
    'www',
    'www-callbacks-jobqueue',
    'wss-backup',
    'wss-mobile',
    'wss-primary',
  ];

  var _teamId;
  var _userId;
  var _persistDraftsTimer;

  var _draftsStore = {
    channelDrafts: {},
    channelIds: []
  };

  function upsertDraft(key, message) {
    _draftsStore.channelDrafts[key] = {
      ops: message.ops,
      range: message.range
    };
  }

  function upsertChannel(channelId) {
    if (_draftsStore.channelIds.indexOf(channelId) < 0) {
      _draftsStore.channelIds.push(channelId);
    }
  }

  function removeDraft(key) {
    delete _draftsStore.channelDrafts[key];
  }

  function removeChannel(channelId) {
    var index = _draftsStore.channelIds.indexOf(channelId);
    if (index > -1) {
      _draftsStore.channelIds.splice(index, 1);
    }
  }

  function shouldSaveDraft(message) {
    return message && message.range && message.range.index > 0;
  }

  function schedulePersist() {
    window.clearInterval(_persistDraftsTimer);
    _persistDraftsTimer = window.setInterval(
      persistDrafts,
      WRITE_TO_STORAGE_DELAY_MS
    );
  }

  function isValidSlackSubdomain(url) {
    if (!/^https:\/\/(?:.*)\.slack\.com(?:\/)?$/.test(url)) return false;
    var a = document.createElement('a');
    a.href = url;
    return SLACK_DOMAIN_BLOCKLIST.indexOf(a.hostname + '.slack.com') === -1;
  }

  function persistDrafts() {
    var key = ["persist-v1", _teamId, _userId, "drafts"].join("::");
    localStorage.setItem(key, JSON.stringify(_draftsStore));
  }

  function onMessage(event) {
    if (!event || !event.data || !event.origin || !isValidSlackSubdomain(event.origin)) {
      return;
    }

    var message;
    try {
      message = JSON.parse(event.data);
    } catch (e) {
      message = {};
    }

    if (message.type !== MESSAGE_TYPE) return;

    _teamId = message.teamId;
    _userId = message.userId;

    var channelId = message.channelId;
    var threadId = message.threadId;
    var draftKey = threadId ? [channelId, threadId].join("-") : channelId;

    if (shouldSaveDraft(message)) {
      upsertDraft(draftKey, message);
      if (draftKey === channelId) upsertChannel(channelId);
    } else {
      removeDraft(draftKey);
      if (draftKey === channelId) removeChannel(channelId);
    }

    schedulePersist();
  }

  window.addEventListener("message", onMessage, false);
})();</script></head><body></body></html>